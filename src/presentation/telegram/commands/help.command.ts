/**
 * @file help.command.ts
 * @brief –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help.
 *
 * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
 */

import { BotContext } from '../types';
import { getErrorHandler } from '../../../infrastructure/errors';

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
 */
export function createHelpCommand() {
  return async (ctx: BotContext): Promise<void> => {
    const errorHandler = getErrorHandler();

    try {
      const isAdmin = ctx.dbUser?.isAdmin() || false;

      let helpMessage: string;

      if (isAdmin) {
        // –°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        helpMessage = `
üìñ *–°–ø—Ä–∞–≤–∫–∞ - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞*

üëë *–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:*
/alltickets - –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Å–∏—Å—Ç–µ–º–µ
/assign <ticket_id> <user_id> - –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é
/ticket <ID> - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–±–ª–µ–º—ã
/close <ID> - –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—É

üìù *–†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏:*
/newticket - –°–æ–æ–±—â–∏—Ç—å –æ –Ω–æ–≤–æ–π –ø—Ä–æ–±–ª–µ–º–µ
/mytickets - –ú–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã
/reply <ID> - –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É

‚ÑπÔ∏è *–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:*
/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

*–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å:*
1. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã: /alltickets
2. –ù–∞–∑–Ω–∞—á—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å–µ–±–µ: /assign <ticket_id> <your_id>
3. –û—Ç–≤–µ—Ç—å—Ç–µ –∫–ª–∏–µ–Ω—Ç—É: /reply <ticket_id>
4. –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è: /close <ticket_id>
        `.trim();
      } else {
        // –°–ø—Ä–∞–≤–∫–∞ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        helpMessage = `
üìñ *–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞*

*–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/newticket - –°–æ–æ–±—â–∏—Ç—å –æ –Ω–æ–≤–æ–π –ø—Ä–æ–±–ª–µ–º–µ
/mytickets - –ü—Ä–æ—Å–º–æ—Ç—Ä –º–æ–∏—Ö –ø—Ä–æ–±–ª–µ–º
/ticket <ID> - –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø—Ä–æ–±–ª–µ–º—ã
/reply <ID> - –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫ –ø—Ä–æ–±–ª–µ–º–µ

*–ö–∞–∫ —Å–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ:*
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /newticket
2. –í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–±–ª–µ–º—ã
3. –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –ø–æ–¥—Ä–æ–±–Ω–æ

*–ö–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É:*
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /mytickets –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –ø—Ä–æ–±–ª–µ–º
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /ticket <ID> –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã
‚Ä¢ –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ /reply <ID>

*–°–æ–≤–µ—Ç—ã:*
‚Ä¢ –û–ø–∏—Å—ã–≤–∞–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ
‚Ä¢ –ü—Ä–∏–∫—Ä–µ–ø–ª—è–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
‚Ä¢ –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –≤ /mytickets
        `.trim();
      }

      await ctx.reply(helpMessage, { parse_mode: 'Markdown' });
    } catch (error) {
      const message = errorHandler.handle(error as Error, {
        command: 'help',
        userId: ctx.from?.id,
      });
      await ctx.reply(message);
    }
  };
}
